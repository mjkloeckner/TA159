import{S as $,W as ee,P as te,O as ne,A as oe,H as ae,D as re,t as se,G as ie,a as le,T as ce,R as de,L as ue,J as fe,b as O,c as V,z as pe,M as R,C as me,I as Y,l as q,m as ge,h as P,n as we,V as H,o as S}from"./OrbitControls-CgjfdclN.js";import{v as xe,f as ye}from"./shaders-Dk4hn-4p.js";import{t as he,r as Me,p as ve}from"./pasto-JkRKC7jR.js";import{e as be}from"./elevation_map_wider_river-Cbe3WljM.js";import{t as Le}from"./tree_forbidden_zone_map_wider_path-Bzrj_VaQ.js";let p,x,v,b,W,J,D,k,B;const G=100,T=100,U=8,E=-1,m={tierra:{url:he,object:null},roca:{url:Me,object:null},pasto:{url:ve,object:null},elevationMap:{url:be,object:null},treeForbiddenMap:{url:Le,object:null}};function K(){x.aspect=b.offsetWidth/b.offsetHeight,x.updateProjectionMatrix(),v.setSize(b.offsetWidth,b.offsetHeight)}function Ae(){p=new $,b=document.getElementById("mainContainer"),v=new ee,v.setClearColor(6316128),b.appendChild(v.domElement),x=new te(35,window.innerWidth/window.innerHeight,.1,1e3),x.position.set(100,120,-100),x.lookAt(0,0,0),new ne(x,v.domElement);const e=new oe(16777215);p.add(e),new ae(16777215,0,.25);const t=new re(16777215,1);t.position.set(100,100,100),p.add(t),new se(t,5);const n=new ie(150,150);p.add(n);const a=new le(5);p.add(a),window.addEventListener("resize",K),K()}function Ge(e,t){let n=t*4,a=e.data;return[a[n],a[n+1],a[n+2],a[n+3]]}function w(e,t,n){return Ge(e,n*e.width+t)}function Q(e){const t=Math.floor(e.x),n=e.y,a=Math.floor(e.z);if(n>5||n<2.65)return console.log("("+e.x+", "+e.y+", "+e.z+") is not valid "),!0;let o=w(k,t,a);const r=o[0],d=o[1],c=o[2];return r<=10&&d>=250&&c<=10||r<=80&&d<=80&&c<=80||r>=200&&d>=200&&c>=200?!0:(console.log("("+e.x+", "+e.y+") is valid "),!1)}function Z(e=0){const t=Math.floor(Math.random()*(G-e*2)),n=Math.floor(Math.random()*(T-e*2)),o=w(B,t,n)[0]/255*U;return new H(t+e,o,n+e)}function Te(e){console.log("Generating `"+e+"` instances of tree");let t=4;const n=new me(.3,.3,t,40,40);n.translate(0,t/2,0);const a=new Y;a.copy(n);const o=new R({color:8142592}),r=new q(a,o,e),d=new ge(1.75,40,40),c=new Y;c.copy(d);const y=new R({color:3561513}),h=new q(c,y,e);new P;const f=new P,u=new P,i=new P,s=3;for(let L=0;L<e;L++){let l=Z(s);for(let M=0;Q(l)&&(l=Z(s),M++!=1e3);++M);if(Q(l))continue;const F=.25;l.x-=(G+s+1.5)/2,l.y+=E-F,l.z-=(T+s)/2,f.makeTranslation(l),u.identity(),i.identity();let g=.6+Math.random()*(t/3);u.makeScale(1,g,1),u.premultiply(f),l.y+=g*t,f.makeTranslation(l),i.premultiply(f),r.setMatrixAt(L,u),h.setMatrixAt(L,i)}return console.log("Done generating `"+e+"` instances of tree"),[r,h]}function je(e,t,n,a,o){console.log("Generating terrain geometry");let r=new we;const d=[],c=[],y=[],h=[];let f=B;const u=a-1;for(let i=0;i<a-1;i++)for(let s=0;s<o-1;s++){let l=w(f,i,s)[0]/255;const F=n*l;let g,M,j,A;g=i>0?w(f,i-1,s)[0]/255:void 0,M=i<a-1?w(f,i+1,s)[0]/255:void 0,j=s>0?w(f,i,s+1)[0]/255:void 0,A=s<o-1?w(f,i,s+1)[0]/255:void 0;let z;g==null?z=M-l:A==null?z=g-l:z=(M-g)/2;let I;j==null?I=A-l:A==null?I=j-l:I=(A-j)/2,d.push(e*i/a-e/2),d.push(F),d.push(t*s/o-t/2);let X=new H(e/a,z*n,0),N=new H(0,I*n,t/o);X.normalize(),N.normalize();let C=new H().crossVectors(N,X);y.push(C.x),y.push(C.y),y.push(C.z),h.push(i/(a-1)),h.push(s/(o-1)),!(i==a-2||s==o-2)&&(c.push(i+s*u),c.push(i+1+s*u),c.push(i+1+(s+1)*u),c.push(i+s*u),c.push(i+1+(s+1)*u),c.push(i+(s+1)*u))}return r.setAttribute("position",new S(d,3)),r.setAttribute("normal",new S(y,3)),r.setAttribute("uv",new S(h,2)),r.setIndex(c),r}function ze(){console.log("Building scene");const e=G,t=T;J=je(e,t,U,G,T),console.log("Applying textures"),W=new fe({uniforms:{dirtSampler:{type:"t",value:m.tierra.object},rockSampler:{type:"t",value:m.roca.object},grassSampler:{type:"t",value:m.pasto.object},scale:{type:"f",value:3},terrainAmplitude:{type:"f",value:U},terrainAmplitudeBottom:{type:"f",value:E},worldNormalMatrix:{type:"m4",value:null},dirtStepWidth:{type:"f",value:.2},rockStepWidth:{type:"f",value:.15}},vertexShader:xe,fragmentShader:ye,side:O}),W.needsUpdate=!0,D=new V(J,W),D.position.set(0,E,0),p.add(D);const n=new pe(e/2,t-1.55),a=new R({color:1223679,side:O}),o=new V(n,a);o.rotateX(Math.PI/2),o.position.set(0,.75,-1),p.add(o);const[r,d]=Te(250);p.add(r),p.add(d)}function Ie(e,t){t.wrapS=t.wrapT=de,m[e].object=t,console.log("Texture `"+e+"` loaded")}function Pe(e){const t=new ue;t.onLoad=()=>{console.log("All textures loaded"),e()};for(const n in m){console.log("Loading textures");const a=new ce(t),o=m[n];o.object=a.load(o.url,Ie.bind(this,n),null,r=>{console.error(r)})}}function _(){requestAnimationFrame(_),v.render(p,x)}function He(){console.log("Loading maps data");let e=document.createElement("canvas"),t=e.getContext("2d"),n=m.treeForbiddenMap.object.image,a=m.elevationMap.object.image;const o=G,r=T;e.width=o,e.height=r,t.drawImage(n,0,0,o,r),k=t.getImageData(0,0,o,r),k.data,t.drawImage(a,0,0,o,r),B=t.getImageData(0,0,o,r),B.data,console.log("All maps data loaded succesfully")}function Be(){He(),ze(),_()}Ae();Pe(Be);
